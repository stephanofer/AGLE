---
import { ProductCard } from "@/components/catalog/ProductCard";
import SectionContainer from "@/components/SectionContainer.astro";
import { enrichProductsWithImages } from "@/lib/data/products";
import type { Product } from "@/lib/data/types";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  import.meta.env.SUPABASE_URL,
  import.meta.env.SUPABASE_ANON_KEY
);

const dataResponse = await supabase.from("products").select("*").limit(3);
const products: Product[] = dataResponse.data || [];

const enrichedProducts = await enrichProductsWithImages(supabase, products);
---

<SectionContainer id="featured-products" class="mt-4">
  <div class="products-container">
    <div class="section-header">
        <h2 class="section-title">Productos Destacados</h2>
      <p class="section-description">Los mejores productos seleccionados para ti</p>
    </div>
    <div class="products-grid">
      {
        enrichedProducts.map((product) => (
          <ProductCard
            product={product}
            primaryImageUrl={product.primaryImageUrl ?? undefined}
            secondaryImageUrl={product.secondaryImageUrl ?? undefined}
            client:visible
          />
        ))
      }
    </div>
  </div>
</SectionContainer>

<style>
  .products-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-section) var(--space-lg);
  }

  .section-header {
    text-align: center;
    margin-bottom: var(--space-xl);
  }

  .section-label {
    display: inline-block;
    font-size: var(--fs-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-primary);
    margin-bottom: var(--space-sm);
  }

  .section-title {
    font-size: var(--fs-3xl);
    font-weight: 450;
    line-height: 1.2;
    color: var(--color-text);
    margin: 0 0 var(--space-sm) 0;
    font-family: var(--font-primary);
  }

  .section-description {
    font-size: var(--fs-md);
    line-height: 1.6;
    color: var(--color-text-light);
    margin: 0;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-md);
  }

  @media (max-width: 1024px) {
    .products-container {
      padding: var(--space-xl) var(--space-md);
    }
  }

  @media (max-width: 768px) {
    .products-container {
      padding: var(--space-xl) var(--space-md);
    }

    .section-header {
      margin-bottom: var(--space-lg);
    }

    .products-grid {
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: var(--space-sm);
    }
  }

  @media (max-width: 480px) {
    .products-container {
      padding: var(--space-lg) var(--space-sm);
    }

    .products-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
